<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .image-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .image-preview {
            width: 100%;
            height: 200px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .image-info {
            font-size: 12px;
            color: #666;
        }
        .image-info strong {
            color: #333;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Portfolio API Debug</h1>
    
    <div class="debug-panel">
        <h2>API Test</h2>
        <div id="apiStatus" class="status info">Testing API connection...</div>
        <div id="apiDetails"></div>
    </div>
    
    <div class="debug-panel">
        <h2>Raw API Response</h2>
        <pre id="rawResponse">Loading...</pre>
    </div>
    
    <div class="debug-panel">
        <h2>Portfolio Images</h2>
        <div id="imageStats" class="status info">Loading...</div>
        <div id="imageGrid" class="image-grid"></div>
    </div>

    <script>
        async function debugAPI() {
            try {
                console.log('üîç Testing API...');
                
                // Test the API
                const response = await fetch('/.netlify/functions/sync-dropbox-background');
                const data = await response.json();
                
                // Show API status
                if (data.success) {
                    document.getElementById('apiStatus').className = 'status success';
                    document.getElementById('apiStatus').textContent = `‚úÖ API working! Found ${data.images.length} images`;
                } else {
                    document.getElementById('apiStatus').className = 'status error';
                    document.getElementById('apiStatus').textContent = `‚ùå API error: ${data.message || 'Unknown error'}`;
                }
                
                // Show API details
                document.getElementById('apiDetails').innerHTML = `
                    <strong>Stats:</strong><br>
                    Total Images: ${data.stats?.totalImages || 0}<br>
                    With URLs: ${data.stats?.imagesWithUrls || 0}<br>
                    Without URLs: ${data.stats?.imagesWithoutUrls || 0}<br>
                    Source: ${data.stats?.source || 'unknown'}<br>
                    Projects: ${data.projects?.join(', ') || 'none'}
                `;
                
                // Show raw response
                document.getElementById('rawResponse').textContent = JSON.stringify(data, null, 2);
                
                // Show images
                if (data.images && data.images.length > 0) {
                    document.getElementById('imageStats').className = 'status success';
                    document.getElementById('imageStats').textContent = `Found ${data.images.length} images in database`;
                    
                    const imageGrid = document.getElementById('imageGrid');
                    imageGrid.innerHTML = '';
                    
                    data.images.forEach((img, index) => {
                        const card = document.createElement('div');
                        card.className = 'image-card';
                        
                        const preview = document.createElement('div');
                        preview.className = 'image-preview';
                        
                        if (img.image_url) {
                            const imgElement = document.createElement('img');
                            imgElement.src = img.image_url;
                            imgElement.alt = img.name;
                            imgElement.onerror = function() {
                                preview.innerHTML = '‚ùå Image failed to load';
                            };
                            preview.appendChild(imgElement);
                        } else {
                            preview.innerHTML = 'üìÑ No image URL';
                        }
                        
                        const info = document.createElement('div');
                        info.className = 'image-info';
                        info.innerHTML = `
                            <strong>${img.name}</strong><br>
                            Project: ${img.project}<br>
                            Tool: ${img.tool}<br>
                            Type: ${img.type}<br>
                            Time: ${img.time}<br>
                            Aspect Ratio: ${img.aspectratio}<br>
                            Has URL: ${img.image_url ? '‚úÖ Yes' : '‚ùå No'}
                        `;
                        
                        card.appendChild(preview);
                        card.appendChild(info);
                        imageGrid.appendChild(card);
                    });
                } else {
                    document.getElementById('imageStats').className = 'status error';
                    document.getElementById('imageStats').textContent = 'No images found';
                }
                
            } catch (error) {
                console.error('Debug error:', error);
                document.getElementById('apiStatus').className = 'status error';
                document.getElementById('apiStatus').textContent = `‚ùå Error: ${error.message}`;
                document.getElementById('rawResponse').textContent = `Error: ${error.message}`;
            }
        }
        
        // Run debug on page load
        debugAPI();
    </script>
</body>
</html>